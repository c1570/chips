// thanks go to VICE
static const char* opcode_list[] = {
    /* 00 */  "%1$02X          BRK           ",
    /* 01 */  "%1$02X %2$02X       ORA ($%2$02X,X)   ",
    /* 02 */  "%1$02X          JAM           ",
    /* 03 */  "%1$02X %2$02X       SLO ($%2$02X,X)   ",
    /* 04 */  "%1$02X %2$02X       NOOP $%2$02X      ",
    /* 05 */  "%1$02X %2$02X       ORA $%2$02X       ",
    /* 06 */  "%1$02X %2$02X       ASL $%2$02X       ",
    /* 07 */  "%1$02X %2$02X       SLO $%2$02X       ",
    /* 08 */  "%1$02X          PHP           ",
    /* 09 */  "%1$02X %2$02X       ORA #$%2$02X      ",
    /* 0a */  "%1$02X          ASL           ",
    /* 0b */  "%1$02X %2$02X       ANC #$%2$02X      ",
    /* 0c */  "%1$02X %2$02X %3$02X    NOOP $%3$02X%2$02X    ",
    /* 0d */  "%1$02X %2$02X %3$02X    ORA $%3$02X%2$02X     ",
    /* 0e */  "%1$02X %2$02X %3$02X    ASL $%3$02X%2$02X     ",
    /* 0f */  "%1$02X %2$02X %3$02X    SLO $%3$02X%2$02X     ",

    /* 10 */  "%1$02X %2$02X       BPL $%4$04X     ",
    /* 11 */  "%1$02X %2$02X       ORA ($%2$02X),Y   ",
    /* 12 */  "%1$02X          JAM           ",
    /* 13 */  "%1$02X %2$02X       SLO ($%2$02X),Y   ",
    /* 14 */  "%1$02X %2$02X       NOOP $%2$02X,X    ",
    /* 15 */  "%1$02X %2$02X       ORA $%2$02X,X     ",
    /* 16 */  "%1$02X %2$02X       ASL $%2$02X,X     ",
    /* 17 */  "%1$02X %2$02X       SLO $%2$02X,X     ",
    /* 18 */  "%1$02X          CLC           ",
    /* 19 */  "%1$02X %2$02X %3$02X    ORA $%3$02X%2$02X,Y   ",
    /* 1a */  "%1$02X          NOOP          ",
    /* 1b */  "%1$02X %2$02X %3$02X    SLO $%3$02X%2$02X,Y   ",
    /* 1c */  "%1$02X %2$02X %3$02X    NOOP $%3$02X%2$02X,X  ",
    /* 1d */  "%1$02X %2$02X %3$02X    ORA $%3$02X%2$02X,X   ",
    /* 1e */  "%1$02X %2$02X %3$02X    ASL $%3$02X%2$02X,X   ",
    /* 1f */  "%1$02X %2$02X %3$02X    SLO $%3$02X%2$02X,X   ",

    /* 20 */  "%1$02X %2$02X %3$02X    JSR $%3$02X%2$02X     ",
    /* 21 */  "%1$02X %2$02X       AND ($%2$02X,X)   ",
    /* 22 */  "%1$02X          JAM           ",
    /* 23 */  "%1$02X %2$02X       RLA ($%2$02X,X)   ",
    /* 24 */  "%1$02X %2$02X       BIT $%2$02X       ",
    /* 25 */  "%1$02X %2$02X       AND $%2$02X       ",
    /* 26 */  "%1$02X %2$02X       ROL $%2$02X       ",
    /* 27 */  "%1$02X %2$02X       RLA $%2$02X       ",
    /* 28 */  "%1$02X          PLP           ",
    /* 29 */  "%1$02X %2$02X       AND #$%2$02X      ",
    /* 2a */  "%1$02X          ROL           ",
    /* 2b */  "%1$02X %2$02X       ANC #$%2$02X      ",
    /* 2c */  "%1$02X %2$02X %3$02X    BIT $%3$02X%2$02X     ",
    /* 2d */  "%1$02X %2$02X %3$02X    AND $%3$02X%2$02X     ",
    /* 2e */  "%1$02X %2$02X %3$02X    ROL $%3$02X%2$02X     ",
    /* 2f */  "%1$02X %2$02X %3$02X    RLA $%3$02X%2$02X     ",

    /* 30 */  "%1$02X %2$02X       BMI $%4$04X     ",
    /* 31 */  "%1$02X %2$02X       AND ($%2$02X),Y   ",
    /* 32 */  "%1$02X          JAM           ",
    /* 33 */  "%1$02X %2$02X       RLA ($%2$02X),Y   ",
    /* 34 */  "%1$02X %2$02X       NOOP $%2$02X,X    ",
    /* 35 */  "%1$02X %2$02X       AND $%2$02X,X     ",
    /* 36 */  "%1$02X %2$02X       ROL $%2$02X,X     ",
    /* 37 */  "%1$02X %2$02X       RLA $%2$02X,X     ",
    /* 38 */  "%1$02X          SEC           ",
    /* 39 */  "%1$02X %2$02X %3$02X    AND $%3$02X%2$02X,Y   ",
    /* 3a */  "%1$02X          NOOP          ",
    /* 3b */  "%1$02X %2$02X %3$02X    RLA $%3$02X%2$02X,Y   ",
    /* 3c */  "%1$02X %2$02X %3$02X    NOOP $%3$02X%2$02X,X  ",
    /* 3d */  "%1$02X %2$02X %3$02X    AND $%3$02X%2$02X,X   ",
    /* 3e */  "%1$02X %2$02X %3$02X    ROL $%3$02X%2$02X,X   ",
    /* 3f */  "%1$02X %2$02X %3$02X    RLA $%3$02X%2$02X,X   ",

    /* 40 */  "%1$02X          RTI           ",
    /* 41 */  "%1$02X %2$02X       EOR ($%2$02X,X)   ",
    /* 42 */  "%1$02X          JAM           ",
    /* 43 */  "%1$02X %2$02X       SRE ($%2$02X,X)   ",
    /* 44 */  "%1$02X %2$02X       NOOP $%2$02X      ",
    /* 45 */  "%1$02X %2$02X       EOR $%2$02X       ",
    /* 46 */  "%1$02X %2$02X       LSR $%2$02X       ",
    /* 47 */  "%1$02X %2$02X       SRE $%2$02X       ",
    /* 48 */  "%1$02X          PHA           ",
    /* 49 */  "%1$02X %2$02X       EOR #$%2$02X      ",
    /* 4a */  "%1$02X          LSR           ",
    /* 4b */  "%1$02X %2$02X       ASR #$%2$02X      ",
    /* 4c */  "%1$02X %2$02X %3$02X    JMP $%3$02X%2$02X     ",
    /* 4d */  "%1$02X %2$02X %3$02X    EOR $%3$02X%2$02X     ",
    /* 4e */  "%1$02X %2$02X %3$02X    LSR $%3$02X%2$02X     ",
    /* 4f */  "%1$02X %2$02X %3$02X    SRE $%3$02X%2$02X     ",

    /* 50 */  "%1$02X %2$02X       BVC $%4$04X     ",
    /* 51 */  "%1$02X %2$02X       EOR ($%2$02X),Y   ",
    /* 52 */  "%1$02X          JAM           ",
    /* 53 */  "%1$02X %2$02X       SRE ($%2$02X),Y   ",
    /* 54 */  "%1$02X %2$02X       NOOP $%2$02X,X    ",
    /* 55 */  "%1$02X %2$02X       EOR $%2$02X,X     ",
    /* 56 */  "%1$02X %2$02X       LSR $%2$02X,X     ",
    /* 57 */  "%1$02X %2$02X       SRE $%2$02X,X     ",
    /* 58 */  "%1$02X          CLI           ",
    /* 59 */  "%1$02X %2$02X %3$02X    EOR $%3$02X%2$02X,Y   ",
    /* 5a */  "%1$02X          NOOP          ",
    /* 5b */  "%1$02X %2$02X %3$02X    SRE $%3$02X%2$02X,Y   ",
    /* 5c */  "%1$02X %2$02X %3$02X    NOOP $%3$02X%2$02X,X  ",
    /* 5d */  "%1$02X %2$02X %3$02X    EOR $%3$02X%2$02X,X   ",
    /* 5e */  "%1$02X %2$02X %3$02X    LSR $%3$02X%2$02X,X   ",
    /* 5f */  "%1$02X %2$02X %3$02X    SRE $%3$02X%2$02X,X   ",

    /* 60 */  "%1$02X          RTS           ",
    /* 61 */  "%1$02X %2$02X       ADC ($%2$02X,X)   ",
    /* 62 */  "%1$02X          JAM           ",
    /* 63 */  "%1$02X %2$02X       RRA ($%2$02X,X)   ",
    /* 64 */  "%1$02X %2$02X       NOOP $%2$02X      ",
    /* 65 */  "%1$02X %2$02X       ADC $%2$02X       ",
    /* 66 */  "%1$02X %2$02X       ROR $%2$02X       ",
    /* 67 */  "%1$02X %2$02X       RRA $%2$02X       ",
    /* 68 */  "%1$02X          PLA           ",
    /* 69 */  "%1$02X %2$02X       ADC #$%2$02X      ",
    /* 6a */  "%1$02X          ROR           ",
    /* 6b */  "%1$02X %2$02X       ARR #$%2$02X      ",
    /* 6c */  "%1$02X %2$02X %3$02X    JMP ($%3$02X%2$02X)   ",
    /* 6d */  "%1$02X %2$02X %3$02X    ADC $%3$02X%2$02X     ",
    /* 6e */  "%1$02X %2$02X %3$02X    ROR $%3$02X%2$02X     ",
    /* 6f */  "%1$02X %2$02X %3$02X    RRA $%3$02X%2$02X     ",

    /* 70 */  "%1$02X %2$02X       BVS $%4$04X     ",
    /* 71 */  "%1$02X %2$02X       ADC ($%2$02X),Y   ",
    /* 72 */  "%1$02X          JAM           ",
    /* 73 */  "%1$02X %2$02X       RRA ($%2$02X),Y   ",
    /* 74 */  "%1$02X %2$02X       NOOP $%2$02X,X    ",
    /* 75 */  "%1$02X %2$02X       ADC $%2$02X,X     ",
    /* 76 */  "%1$02X %2$02X       ROR $%2$02X,X     ",
    /* 77 */  "%1$02X %2$02X       RRA $%2$02X,X     ",
    /* 78 */  "%1$02X          SEI           ",
    /* 79 */  "%1$02X %2$02X %3$02X    ADC $%3$02X%2$02X,Y   ",
    /* 7a */  "%1$02X          NOOP          ",
    /* 7b */  "%1$02X %2$02X %3$02X    RRA $%3$02X%2$02X,Y   ",
    /* 7c */  "%1$02X %2$02X %3$02X    NOOP $%3$02X%2$02X,X  ",
    /* 7d */  "%1$02X %2$02X %3$02X    ADC $%3$02X%2$02X,X   ",
    /* 7e */  "%1$02X %2$02X %3$02X    ROR $%3$02X%2$02X,X   ",
    /* 7f */  "%1$02X %2$02X %3$02X    RRA $%3$02X%2$02X,X   ",

    /* 80 */  "%1$02X %2$02X       NOOP #$%2$02X     ",
    /* 81 */  "%1$02X %2$02X       STA ($%2$02X,X)   ",
    /* 82 */  "%1$02X %2$02X       NOOP #$%2$02X     ",
    /* 83 */  "%1$02X %2$02X       SAX ($%2$02X,X)   ",
    /* 84 */  "%1$02X %2$02X       STY $%2$02X       ",
    /* 85 */  "%1$02X %2$02X       STA $%2$02X       ",
    /* 86 */  "%1$02X %2$02X       STX $%2$02X       ",
    /* 87 */  "%1$02X %2$02X       SAX $%2$02X       ",
    /* 88 */  "%1$02X          DEY           ",
    /* 89 */  "%1$02X %2$02X       NOOP #$%2$02X     ",
    /* 8a */  "%1$02X          TXA           ",
    /* 8b */  "%1$02X %2$02X       ANE #$%2$02X      ",
    /* 8c */  "%1$02X %2$02X %3$02X    STY $%3$02X%2$02X     ",
    /* 8d */  "%1$02X %2$02X %3$02X    STA $%3$02X%2$02X     ",
    /* 8e */  "%1$02X %2$02X %3$02X    STX $%3$02X%2$02X     ",
    /* 8f */  "%1$02X %2$02X %3$02X    SAX $%3$02X%2$02X     ",

    /* 90 */  "%1$02X %2$02X       BCC $%4$04X     ",
    /* 91 */  "%1$02X %2$02X       STA ($%2$02X),Y   ",
    /* 92 */  "%1$02X          JAM           ",
    /* 93 */  "%1$02X %2$02X       SHA ($%2$02X),Y   ",
    /* 94 */  "%1$02X %2$02X       STY $%2$02X,X     ",
    /* 95 */  "%1$02X %2$02X       STA $%2$02X,X     ",
    /* 96 */  "%1$02X %2$02X       STX $%2$02X,Y     ",
    /* 97 */  "%1$02X %2$02X       SAX $%2$02X,Y     ",
    /* 98 */  "%1$02X          TYA           ",
    /* 99 */  "%1$02X %2$02X %3$02X    STA $%3$02X%2$02X,Y   ",
    /* 9a */  "%1$02X          TXS           ",
    /* 9b */  "%1$02X %2$02X %3$02X    SHS $%3$02X%2$02X,Y   ",
    /* 9c */  "%1$02X %2$02X %3$02X    SHY $%3$02X%2$02X,X   ",
    /* 9d */  "%1$02X %2$02X %3$02X    STA $%3$02X%2$02X,X   ",
    /* 9e */  "%1$02X %2$02X %3$02X    SHX $%3$02X%2$02X,Y   ",
    /* 9f */  "%1$02X %2$02X %3$02X    SHA $%3$02X%2$02X,Y   ",

    /* a0 */  "%1$02X %2$02X       LDY #$%2$02X      ",
    /* a1 */  "%1$02X %2$02X       LDA ($%2$02X,X)   ",
    /* a2 */  "%1$02X %2$02X       LDX #$%2$02X      ",
    /* a3 */  "%1$02X %2$02X       LAX ($%2$02X,X)   ",
    /* a4 */  "%1$02X %2$02X       LDY $%2$02X       ",
    /* a5 */  "%1$02X %2$02X       LDA $%2$02X       ",
    /* a6 */  "%1$02X %2$02X       LDX $%2$02X       ",
    /* a7 */  "%1$02X %2$02X       LAX $%2$02X       ",
    /* a8 */  "%1$02X          TAY           ",
    /* a9 */  "%1$02X %2$02X       LDA #$%2$02X      ",
    /* aa */  "%1$02X          TAX           ",
    /* ab */  "%1$02X %2$02X       LXA #$%2$02X      ",
    /* ac */  "%1$02X %2$02X %3$02X    LDY $%3$02X%2$02X     ",
    /* ad */  "%1$02X %2$02X %3$02X    LDA $%3$02X%2$02X     ",
    /* ae */  "%1$02X %2$02X %3$02X    LDX $%3$02X%2$02X     ",
    /* af */  "%1$02X %2$02X %3$02X    LAX $%3$02X%2$02X     ",

    /* b0 */  "%1$02X %2$02X       BCS $%4$04X     ",
    /* b1 */  "%1$02X %2$02X       LDA ($%2$02X),Y   ",
    /* b2 */  "%1$02X          JAM           ",
    /* b3 */  "%1$02X %2$02X       LAX ($%2$02X),Y   ",
    /* b4 */  "%1$02X %2$02X       LDY $%2$02X,X     ",
    /* b5 */  "%1$02X %2$02X       LDA $%2$02X,X     ",
    /* b6 */  "%1$02X %2$02X       LDX $%2$02X,Y     ",
    /* b7 */  "%1$02X %2$02X       LAX $%2$02X,Y     ",
    /* b8 */  "%1$02X          CLV           ",
    /* b9 */  "%1$02X %2$02X %3$02X    LDA $%3$02X%2$02X,Y   ",
    /* ba */  "%1$02X          TSX           ",
    /* bb */  "%1$02X %2$02X %3$02X    LAS $%3$02X%2$02X,Y   ",
    /* bc */  "%1$02X %2$02X %3$02X    LDY $%3$02X%2$02X,X   ",
    /* bd */  "%1$02X %2$02X %3$02X    LDA $%3$02X%2$02X,X   ",
    /* be */  "%1$02X %2$02X %3$02X    LDX $%3$02X%2$02X,Y   ",
    /* bf */  "%1$02X %2$02X %3$02X    LAX $%3$02X%2$02X,Y   ",

    /* c0 */  "%1$02X %2$02X       CPY #$%2$02X      ",
    /* c1 */  "%1$02X %2$02X       CMP ($%2$02X,X)   ",
    /* c2 */  "%1$02X %2$02X       NOOP #$%2$02X     ",
    /* c3 */  "%1$02X %2$02X       DCP ($%2$02X,X)   ",
    /* c4 */  "%1$02X %2$02X       CPY $%2$02X       ",
    /* c5 */  "%1$02X %2$02X       CMP $%2$02X       ",
    /* c6 */  "%1$02X %2$02X       DEC $%2$02X       ",
    /* c7 */  "%1$02X %2$02X       DCP $%2$02X       ",
    /* c8 */  "%1$02X          INY           ",
    /* c9 */  "%1$02X %2$02X       CMP #$%2$02X      ",
    /* ca */  "%1$02X          DEX           ",
    /* cb */  "%1$02X %2$02X       SBX #$%2$02X      ",
    /* cc */  "%1$02X %2$02X %3$02X    CPY $%3$02X%2$02X     ",
    /* cd */  "%1$02X %2$02X %3$02X    CMP $%3$02X%2$02X     ",
    /* ce */  "%1$02X %2$02X %3$02X    DEC $%3$02X%2$02X     ",
    /* cf */  "%1$02X %2$02X %3$02X    DCP $%3$02X%2$02X     ",

    /* d0 */  "%1$02X %2$02X       BNE $%4$04X     ",
    /* d1 */  "%1$02X %2$02X       CMP ($%2$02X),Y   ",
    /* d2 */  "%1$02X          JAM           ",
    /* d3 */  "%1$02X %2$02X       DCP ($%2$02X),Y   ",
    /* d4 */  "%1$02X %2$02X       NOOP $%2$02X,X    ",
    /* d5 */  "%1$02X %2$02X       CMP $%2$02X,X     ",
    /* d6 */  "%1$02X %2$02X       DEC $%2$02X,X     ",
    /* d7 */  "%1$02X %2$02X       DCP $%2$02X,X     ",
    /* d8 */  "%1$02X          CLD           ",
    /* d9 */  "%1$02X %2$02X %3$02X    CMP $%3$02X%2$02X,Y   ",
    /* da */  "%1$02X          NOOP          ",
    /* db */  "%1$02X %2$02X %3$02X    DCP $%3$02X%2$02X,Y   ",
    /* dc */  "%1$02X %2$02X %3$02X    NOOP $%3$02X%2$02X,X  ",
    /* dd */  "%1$02X %2$02X %3$02X    CMP $%3$02X%2$02X,X   ",
    /* de */  "%1$02X %2$02X %3$02X    DEC $%3$02X%2$02X,X   ",
    /* df */  "%1$02X %2$02X %3$02X    DCP $%3$02X%2$02X,X   ",

    /* e0 */  "%1$02X %2$02X       CPX #$%2$02X      ",
    /* e1 */  "%1$02X %2$02X       SBC ($%2$02X,X)   ",
    /* e2 */  "%1$02X %2$02X       NOOP #$%2$02X     ",
    /* e3 */  "%1$02X %2$02X       ISB ($%2$02X,X)   ",
    /* e4 */  "%1$02X %2$02X       CPX $%2$02X       ",
    /* e5 */  "%1$02X %2$02X       SBC $%2$02X       ",
    /* e6 */  "%1$02X %2$02X       INC $%2$02X       ",
    /* e7 */  "%1$02X %2$02X       ISB $%2$02X       ",
    /* e8 */  "%1$02X          INX           ",
    /* e9 */  "%1$02X %2$02X       SBC #$%2$02X      ",
    /* ea */  "%1$02X          NOP           ",
    /* eb */  "%1$02X %2$02X       USBC #$%2$02X     ",
    /* ec */  "%1$02X %2$02X %3$02X    CPX $%3$02X%2$02X     ",
    /* ed */  "%1$02X %2$02X %3$02X    SBC $%3$02X%2$02X     ",
    /* ee */  "%1$02X %2$02X %3$02X    INC $%3$02X%2$02X     ",
    /* ef */  "%1$02X %2$02X %3$02X    ISB $%3$02X%2$02X     ",

    /* f0 */  "%1$02X %2$02X       BEQ $%4$04X     ",
    /* f1 */  "%1$02X %2$02X       SBC ($%2$02X),Y   ",
    /* f2 */  "%1$02X          JAM           ",
    /* f3 */  "%1$02X %2$02X       ISB ($%2$02X),Y   ",
    /* f4 */  "%1$02X %2$02X       NOOP $%2$02X,X    ",
    /* f5 */  "%1$02X %2$02X       SBC $%2$02X,X     ",
    /* f6 */  "%1$02X %2$02X       INC $%2$02X,X     ",
    /* f7 */  "%1$02X %2$02X       ISB $%2$02X,X     ",
    /* f8 */  "%1$02X          SED           ",
    /* f9 */  "%1$02X %2$02X %3$02X    SBC $%3$02X%2$02X,Y   ",
    /* fa */  "%1$02X          NOOP          ",
    /* fb */  "%1$02X %2$02X %3$02X    ISB $%3$02X%2$02X,Y   ",
    /* fc */  "%1$02X %2$02X %3$02X    NOOP $%3$02X%2$02X,X  ",
    /* fd */  "%1$02X %2$02X %3$02X    SBC $%3$02X%2$02X,X   ",
    /* fe */  "%1$02X %2$02X %3$02X    INC $%3$02X%2$02X,X   ",
    /* ff */  "%1$02X %2$02X %3$02X    ISB $%3$02X%2$02X,X   "
};
static void _show_debug_trace(char device, m6502_t *cpu, uint cur_tick, uint8_t a, uint8_t b, uint8_t c) {
  // .C:08a9  CD 12 D0    CMP $D012     A:6f X:1b Y:00 SP:f6 ..-..I..      6795806
  char flags[] = "NV-.DIZC";
  for(int i = 0; i < 8; i++) {
    if(i==2 || i==3) continue;
    if(!(cpu->P & (1<<(7-i)))) flags[i] = '.';
  }
  char opc_decoded[30];
  char debug_opc_decoded[80];
  sprintf(opc_decoded, opcode_list[a], a, b, c, cpu->PC + ((int8_t)b) + 2);
  sprintf(debug_opc_decoded,
          ".%c:%04x  %s A:%02x X:%02x Y:%02x SP:%02x %s",
          device, cpu->PC, opc_decoded, cpu->A, cpu->X, cpu->Y, cpu->S, flags);
  printf("%s   %10d\n", debug_opc_decoded, cur_tick);
}
